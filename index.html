<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>转</title>

<style>
    body {
        margin: 0;
        font-family: "Heebo", "Segoe UI", sans-serif;
        background: url('20251217_223954.jpg') no-repeat center center fixed;
        background-size: cover;
        text-align: center;
        color: #fff;
        min-height: 100vh;
    }

    h1 { margin: 20px 0 5px; font-size: 42px; text-shadow: 2px 2px 10px rgba(0,0,0,0.9); }

    /*  砖 */
    .calendar {
        width: 98%; max-width: 1150px; margin: 0 auto 30px;
        background: rgba(0, 0, 0, 0.18); backdrop-filter: blur(4px);
        border-radius: 15px; border: 2px solid rgba(255, 255, 255, 0.35);
        overflow: hidden;
    }
    .calendar-header { display: grid; grid-template-columns: repeat(7, 1fr); background: rgba(255, 255, 255, 0.2); font-weight: bold; border-bottom: 3px solid rgba(255, 255, 255, 0.4); }
    .calendar-header div { padding: 15px 0; font-size: 18px; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }

    .day {
        min-height: 160px; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.5); 
        background: rgba(0, 0, 0, 0.2); display: flex; flex-direction: column; 
        align-items: center; box-sizing: border-box; position: relative;
    }

    .hebrew { font-size: 16px; font-weight: bold; text-shadow: 1px 1px 4px rgba(0,0,0,0.8); }
    .gregorian { font-size: 13px; color: #eee; margin-bottom: 5px; }

    /* 注爪 驻转专 注驻 */
    .open-letter-btn {
        margin: 8px 0; background: rgba(255, 204, 0, 0.9); border: none;
        border-radius: 50%; width: 45px; height: 45px; cursor: pointer;
        font-size: 22px; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .open-letter-btn:hover { transform: scale(1.2) rotate(5deg); background: #ffcc00; }
    .open-letter-btn:active { transform: scale(0.9); }

    .note-input {
        width: 95%; margin-top: auto; border: 1px solid rgba(255,255,255,0.3);
        border-radius: 4px; font-size: 12px; padding: 4px;
        background: rgba(255, 255, 255, 0.1); color: white; resize: none; text-align: center;
    }

    .past-day { background-color: rgba(0, 0, 0, 0.6) !important; opacity: 0.6; }
    .today { background-color: rgba(255, 255, 255, 0.3) !important; border: 4px solid #ffcc00 !important; z-index: 5; }
    .wedding-day { background: rgba(212, 163, 115, 0.5) !important; border: 3px solid #d4a373 !important; }

    /* 爪转 驻转转 转 */
    @keyframes envelopeOpen {
        0% { transform: scale(0) translateY(100px); opacity: 0; }
        100% { transform: scale(1) translateY(0); opacity: 1; }
    }

    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px);
        display: none; justify-content: center; align-items: center; z-index: 2000;
        transition: opacity 0.3s ease;
    }

    .modal-content {
        background: #fdfdfd; color: #444; width: 85%; max-width: 450px;
        min-height: 300px; padding: 50px 40px; border-radius: 3px;
        position: relative; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        text-align: right; border-right: 10px solid #d4a373;
        background-image: linear-gradient(#e1e1e1 1px, transparent 1px);
        background-size: 100% 2.2rem;
        animation: envelopeOpen 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .close-btn {
        position: absolute; top: 10px; left: 10px;
        background: #eee; border: none; width: 30px; height: 30px;
        border-radius: 50%; cursor: pointer; font-size: 18px; color: #888;
        transition: 0.2s;
    }
    .close-btn:hover { background: #d9534f; color: white; }

    .letter-title { font-size: 1.8rem; font-weight: bold; color: #d4a373; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
    .letter-body { font-size: 1.3rem; line-height: 2.2rem; color: #2c3e50; font-family: 'Segoe UI', serif; }
    .blurred { filter: blur(10px); user-select: none; pointer-events: none; opacity: 0.4; }

    .locked-msg {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: white; padding: 15px 25px; border-radius: 50px;
        color: #c0392b; font-weight: bold; border: 2px solid #c0392b; 
        width: 80%; text-align: center; z-index: 10;
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    /* 驻转专 专转 转 */
    .selection-container { display: flex; gap: 20px; justify-content: center; margin-top: 20px; }
    .select-btn {
        padding: 15px 30px; font-size: 20px; font-weight: bold; border: none; border-radius: 10px;
        cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .btn-david { background: #d4a373; color: white; }
    .btn-tehila { background: #e07a5f; color: white; }
    .select-btn:hover { transform: translateY(-3px); filter: brightness(1.1); }

    /* 住驻专 专 */
    .countdown {
        width: 90%; max-width: 800px; margin: 0 auto 40px; padding: 20px;
        background: rgba(0, 0, 0, 0.7); border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        font-size: 20px; line-height: 1.5;
    }
    .highlight { color: #ffcc00; font-weight: bold; font-size: 24px; }
</style>
</head>

<body>

<h1>转 砖  & 转</h1>

<div class="calendar">
    <div class="calendar-header">
        <div>专砖</div><div>砖</div><div>砖砖</div><div>专注</div><div>砖</div><div>砖砖</div><div>砖转</div>
    </div>
    <div class="calendar-grid" id="calendarGrid"></div>
</div>

<div class="countdown" id="countdown"></div>

<div class="modal-overlay" id="modalOverlay" onclick="closeLetter()">
    <div class="modal-content" id="modalContent" onclick="event.stopPropagation()">
        <button class="close-btn" onclick="closeLetter()">&times;</button>
        <div id="lockedMessage" class="locked-msg" style="display:none;"> 注  注  驻转 转 转!</div>
        <div id="selectionMode">
            <h2 style="color:#d4a373">专/ 转 拽专:</h2>
            <div class="selection-container">
                <button class="select-btn btn-david" onclick="showSpecificLetter('david')"></button>
                <button class="select-btn btn-tehila" onclick="showSpecificLetter('tehila')">转</button>
            </div>
        </div>
        <div id="letterView" style="display:none;">
            <div id="letterTitle" class="letter-title"></div>
            <div id="letterText" class="letter-body"></div>
            <button onclick="backToSelection()" style="margin-top:20px; background:none; border:none; color:#888; cursor:pointer; text-decoration:underline;">专 专</button>
        </div>
    </div>
</div>

<script>
let davidLetters = {};
let tehilaLetters = {};
let currentActiveId = null;

const davidUrl = 'https://docs.google.com/document/d/12bcJIg6WUSwJzMR1DxpQSWq63zyb8a_0sGPrEZE9YfE/export?format=txt'; 
const tehilaUrl = 'https://docs.google.com/document/d/12bcJIg6WUSwJzMR1DxpQSWq63zyb8a_0sGPrEZE9YfE/export?format=txt'; // <--- 砖  转 转转 砖 转

const startDate = new Date(2025, 11, 21); 
const weddingDate = new Date(2026, 2, 1, 19, 0, 0); 
const today = new Date();
today.setHours(0,0,0,0);

const grid = document.getElementById("calendarGrid");
const monthFormatter = new Intl.DateTimeFormat("he-u-ca-hebrew", {month: "long"});
const dayNumFormatter = new Intl.DateTimeFormat("he-u-ca-hebrew", {day: "numeric"});

// 注转 砖 拽爪
Promise.all([
    fetch(davidUrl).then(res => res.json()).catch(() => ({})),
    fetch(tehilaUrl).then(res => res.json()).catch(() => ({}))
]).then(([davidData, tehilaData]) => {
    davidLetters = davidData;
    tehilaLetters = tehilaData;
    init();
}).catch(err => {
    console.error("砖 注:", err);
    init();
});

function init() {
    buildCalendar();
    updateCountdown();
    setInterval(updateCountdown, 1000);
}

function toGematria(num) {
    if (num === 15) return "";
    if (num === 16) return "";
    const units = ["", "'", "'", "'", "'", "'", "'", "'", "'", "'"];
    const tens = ["", "'", "'", "'", "'", "'", "住'", "注'", "驻'", "爪'"];
    let res = "";
    if (num >= 10) res += tens[Math.floor(num / 10)];
    res += units[num % 10];
    return res;
}

function buildCalendar() {
    let current = new Date(startDate);
    grid.innerHTML = "";
    for (let i = 0; i < startDate.getDay(); i++) {
        const empty = document.createElement("div");
        empty.className = "day";
        empty.style.background = "rgba(0,0,0,0.05)";
        grid.appendChild(empty);
    }
    while (current <= weddingDate) {
        const cell = document.createElement("div");
        const dateKey = current.toDateString();
        const year = current.getFullYear();
        const month = String(current.getMonth() + 1).padStart(2, '0');
        const day = String(current.getDate()).padStart(2, '0');
        const dateId = `${year}-${month}-${day}`;
        const isToday = current.getTime() === today.getTime();
        const isPast = current < today;
        const isFuture = current > today;
        let classes = ["day"];
        if (isToday) classes.push("today");
        if (isPast && !isToday) classes.push("past-day");
        if (current.getFullYear() === 2026 && current.getMonth() === 2 && current.getDate() === 1) classes.push("wedding-day");
        cell.className = classes.join(" ");
        const hebDay = toGematria(parseInt(dayNumFormatter.format(current)));
        const hebMonth = monthFormatter.format(current);
        cell.innerHTML = `
            <div class="hebrew">${hebDay} ${hebMonth}</div>
            <div class="gregorian">${current.getDate()}.${current.getMonth()+1}.${current.getFullYear()}</div>
            <button class="open-letter-btn">わ</button>
            <textarea class="note-input" placeholder="注专..." oninput="localStorage.setItem('${dateKey}', this.value)">${localStorage.getItem(dateKey) || ""}</textarea>
        `;
        cell.querySelector('.open-letter-btn').onclick = (e) => {
            e.stopPropagation();
            openSelection(dateId, isFuture);
        };
        grid.appendChild(cell);
        current.setDate(current.getDate() + 1);
    }
}

function openSelection(id, isLocked) {
    currentActiveId = id;
    const overlay = document.getElementById('modalOverlay');
    const lockMsg = document.getElementById('lockedMessage');
    const selection = document.getElementById('selectionMode');
    const letterView = document.getElementById('letterView');

    overlay.style.display = 'flex';
    
    if (isLocked) {
        selection.classList.add('blurred');
        letterView.classList.add('blurred');
        lockMsg.style.display = 'block';
    } else {
        selection.classList.remove('blurred');
        letterView.classList.remove('blurred');
        lockMsg.style.display = 'none';
    }
    backToSelection();
}

function showSpecificLetter(who) {
    document.getElementById('selectionMode').style.display = 'none';
    const view = document.getElementById('letterView');
    const title = document.getElementById('letterTitle');
    const text = document.getElementById('letterText');
    
    view.style.display = 'block';
    if(who === 'david') {
        title.innerText = '转 ';
        text.innerText = davidLetters[currentActiveId] || " 驻注 转 砖 砖 ...";
    } else {
        title.innerText = '转 转';
        text.innerText = tehilaLetters[currentActiveId] || " 驻注 转 砖 砖 转...";
    }
}

function backToSelection() {
    document.getElementById('selectionMode').style.display = 'block';
    document.getElementById('letterView').style.display = 'none';
}

function closeLetter() {
    document.getElementById('modalOverlay').style.display = 'none';
}

function updateCountdown() {
    const now = new Date();
    const diff = weddingDate - now;
    if (diff <= 0) {
        document.getElementById("countdown").innerHTML = "    转! ";
        return;
    }
    const totalSeconds = Math.floor(diff / 1000);
    const seconds = totalSeconds % 60;
    const minutes = Math.floor(totalSeconds / 60) % 60;
    const hours = Math.floor(totalSeconds / 3600) % 24;
    const totalDays = Math.floor(totalSeconds / 86400);
    const weeks = Math.floor(totalDays / 7);
    const remainingDays = totalDays % 7;

    document.getElementById("countdown").innerHTML = `
        砖专 注 <span class="highlight">${totalDays}</span> <br>
        砖 <span class="highlight">${weeks}</span> 砖注转, 
        <span class="highlight">${remainingDays}</span> , 
        <span class="highlight">${hours}</span> 砖注转, 
        <span class="highlight">${minutes}</span> 拽转 -<span class="highlight">${seconds}</span> 砖转
    `;
}
</script>
</body>
</html>
